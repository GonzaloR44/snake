' Gambas class file


' Gambas class file


'########################################################################
'
'ESTADO - ATRIBUTOS
'
'########################################################################

'Lista: [0] es la cabeza

Private longitud As Short 
Private muerta As Boolean
Private cuerpo As Cuadrado[]
Private direccion As String
Private movimientoBuff As Boolean


'########################################################################
'
'COMPORTAMIENTO - MÉTODOS
'
'########################################################################
'Moverse
'Pintarse

'Constructor
Public Sub _new(nuevaX As Short, nuevaY As Short, colorSerpiente As Integer)
  
  Dim cabeza As Cuadrado
  'La serpiente siempre es de 20px
  cabeza = New Cuadrado(colorSerpiente, 20, nuevaX, nuevaY)
  cuerpo = New Cuadrado[]
  cuerpo.Add(cabeza)
  direccion = "D"
  
  
End

Public Sub cambiarDir(letra As String)

   If (letra = "W" And direccion <> "S") Or (letra = "A" And direccion <> "D") Or (letra = "S" And direccion <> "W") Or (letra = "D" And direccion <> "A") Then
      If direccion <> letra Then
         direccion = letra
         If movimientoBuff = False Then 
            Dim newCabeza As Cuadrado
            'La serpiente siempre es de 20px
            newCabeza = New Cuadrado(cuerpo.Last.getColor(), 20, cuerpo.Last.getX(), cuerpo.Last.getY())
            cuerpo.Add(newCabeza)
            newCabeza.moverse(direccion)
            movimientoBuff = True
         Endif
      Endif 
   Endif  
  
End


Public Sub pintarse(tablero As DrawingArea)
  Dim iContador As Integer
  For iContador = 0 To cuerpo.Count - 1
    cuerpo[iContador].pintarse(tablero)
    Dim green As Integer = 255 - (cuerpo.Count - iContador) * 5
    If green > 230 Then green = 230  
    If green < 1 Then green = 0  
    cuerpo[iContador].setColor(Color.RGB(0, green, 0))
  Next  
  
  cuerpo.Last.setColor(Color.Green)
End

Public Sub crecer()
   If movimientoBuff = False Then
      'Nuevo cuadrado --> Ponerlo en la cabeza --> Se añade al Array --> Se mueve un paso adelante
      Dim newCabeza As Cuadrado
      'La serpiente siempre es de 20px
      newCabeza = New Cuadrado(cuerpo.Last.getColor(), 20, cuerpo.Last.getX(), cuerpo.Last.getY())
      cuerpo.Add(newCabeza)
      newCabeza.moverse(direccion)
   Else 
      movimientoBuff = False
   Endif 
   
End

Public Function estasMuerta(iAncho As Integer, iAlto As Integer) As Boolean
  Dim bResultado As Boolean
  Dim iContador As Integer
  Dim cabeza As Cuadrado
  Dim lado As Short
  bResultado = False
  iContador = 0
  cabeza = cuerpo.Last
  lado = 20
  
  If cabeza.getX() < 0 Or cabeza.getY() < 0 Or cabeza.getX() > iAncho - lado Or cabeza.getY() > iAlto - lado Then 
     bResultado = True
  Endif
  'Si cada cuadrado mas de quinta posicion(4)es de X y Y = cabeza == > muere
  For iContador = 0 To cuerpo.Count - 4
    If cuerpo[iContador].getX() = cabeza.getX() And cuerpo[iContador].getY() = cabeza.getY() Then 
       bResultado = True
    Endif
  Next  
  
  Return bResultado
  
End



Public Sub moverse()

  Me.crecer()
  cuerpo.Extract(0, 1)
  
End

